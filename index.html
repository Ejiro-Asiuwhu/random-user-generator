<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="theme-color" content="#ec9b3b">
    <!-- Favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="assets/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="assets/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="./assets/favicon/favicon-16x16.png">
    <link rel="manifest" href="manifest.json">
    <link rel="mask-icon" href="./assets/favicon/safari-pinned-tab.svg" color="#ec9b3b">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="theme-color" content="#ec9b3b">
    <!-- custom css -->
    <link rel="stylesheet" href="./css/style.css ">
    <title>Random User Generator</title>
</head>

<body>
    <div class="container">
        <h1 class="title"> Random User Generator</h1>
        <div class="user-profile">
            <img id="avatar" src="https://randomuser.me/api/portraits/med/women/50.jpg" />
            <div id="fullname">Dolores Bell</div>
            <div id="username">organicbird320</div>
            <div class="description">
                <div>Email: <span id="email">dolores.bell@example.com</span></div>
                <div>City: <span id="city">Costa Mesa</span></div>
                <div>Nationality: <span id="nationalty">US</span></div>
            </div>
            <div class="footer"><button id="btn">Next User!</button></div>
        </div>
        <div id="notification">A new version of this app is available. Click <a id="reload">here</a> to update.</div>
    </div>
    <script src="./js/script.js"></script>
    <script>
        let newWorker;

        function showUpdateBar() {
            let snackbar = document.getElementById('snackbar');
            snackbar.className = 'show';
        }
        // The click event on the notification
        document.querySelector('#reload').addEventListener('click', () => {
            newWorker.postMessage({
                action: 'skipWaiting'
            });
        });


        if ('serviceWorker' in navigator) {
            window.addEventListener('load', event => {
                // Register the service worker
                navigator.serviceWorker.register('/sw.js')
                    .then(reg => {
                        reg.addEventListener('updatefound', () => {
                            // An updated service worker has appeared in reg.installing!
                            newWorker = reg.installing;

                            newWorker.addEventListener('statechange', () => {

                                // Has service worker state changed?
                                switch (newWorker.state) {
                                    case 'installed':

                                        // There is a new service worker available, show the notification
                                        if (navigator.serviceWorker.controller) {
                                            let notification = document.getElementById(
                                                'notification ');
                                            notification.className = 'show';
                                        }

                                        break;
                                }
                            });
                        })
                        console.log('Service worker registered ', reg);
                    })
                    .catch(err => {
                        console.log('Service worker registration failed', err);
                    })
            })
        }


        let refreshing;
        // The event listener that is fired when the service worker updates
        // Here we reload the page
        navigator.serviceWorker.addEventListener('controllerchange', function () {
            if (refreshing) return;
            window.location.reload();
            refreshing = true;
        });
    </script>
</body>

</html>